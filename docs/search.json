[{"path":"https://kylebutts.github.io/did2s/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2021 did2s authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://kylebutts.github.io/did2s/articles/Two-Stage-Difference-in-Differences.html","id":"two-stage-difference-in-differences-gardner-2021","dir":"Articles","previous_headings":"","what":"Two-stage Difference-in-differences, Gardner (2021)","title":"Two-Stage Difference-in-Differences","text":"Researchers often want difference--differences () model regression setting. Typically, made use -called twoway fixed effects (TWFE) framework. example, static setting: \\[\\begin{equation}   y_{} = \\mu_i + \\mu_t + \\tau D_{} + \\varepsilon_{}, \\end{equation}\\] \\(\\mu_i\\) unit fixed effects, \\(\\mu_t\\) time fixed effects, \\(D_{}\\) indicator receiving treatment. Similarly, (dynamic) event-study TWFE model written : \\[\\begin{equation} y_{} = \\mu_i + \\mu_t + \\sum_{k = -L}^{-2} \\tau^k D_{}^k + \\sum_{k = 1}^{K} \\tau^k D_{}^k + \\varepsilon_{}, \\end{equation}\\] \\(D_{}^k\\) lag/leads treatment (k periods initial treatment date). However, running OLS estimate either model shown recover average treatment effect potential severely misleading cases treatment effect heterogeneity Borusyak et. al. (2021); Callaway Sant’Anna (2020); de Chaisemartin d’Haultfoeuille (2020); Goodman-Bacon (2021); Sun Abraham (2020)]. One way thinking problem Frisch–Waugh–Lovell (FWL) theorem. estimating unit time fixed effects, create residualized \\(\\tilde{Y}_{}\\) commonly said “outcome variable removing time shocks fixed units characteristics”, also create residulaized \\(\\tilde{D}_{}\\) \\(\\tilde{D}_{}^k\\). simplify literature, residualized treatment indicators creates problem interpreting \\(\\tau\\) \\(\\tau^k\\), especially treatment effects heterogeneous. ’s Gardner (2021) comes . Gardner fix problem quite simple: estimate \\(\\mu_i\\) \\(\\mu_t\\) seperately don’t residualize treatment indicators. absence treatment, TWFE model gives model (potentially unobserved) untreated outcomes \\[y_{}(0) = \\mu_i + \\mu_t + \\varepsilon_{}.\\] Therefore, can consistently estimate \\(y_{}(0)\\), can impute untreated outcome remove observed outcome \\(y_{}\\). value \\(y_{} - \\hat{y}_{}(0)\\) close zero control units close \\(\\tau_{}\\) treated observations. , regressing \\(y_{} - \\hat{y}_{}(0)\\) treatment variables give unbiased estimates treatment effects (either static dynamic/event-study). steps two-step estimator : First estimate \\(\\mu_i\\) \\(\\mu_t\\) using untreated/-yet-treated observations, .e. subsample \\(D_{}=0\\). Residualize outcomes \\(\\tilde{y}_{} = y_{} - \\hat{\\mu}_i - \\hat{\\mu}_t\\). Regress \\(\\tilde{y}_{}\\) \\(D_{}\\) \\(D_{}^k\\)’s estimate treatment effect \\(\\tau\\) \\(\\tau^k\\)’s. notes:","code":""},{"path":"https://kylebutts.github.io/did2s/articles/Two-Stage-Difference-in-Differences.html","id":"standard-errors","dir":"Articles","previous_headings":"Two-stage Difference-in-differences, Gardner (2021)","what":"Standard Errors","title":"Two-Stage Difference-in-Differences","text":"First, standard errors \\(\\tau\\) \\(\\tau^k\\)’s incorrect dependent variable estimate. referred generated regressor problem econometrics parlance. Therefore, Gardner (2021) developed GMM estimator give asymptotically correct standard errors.","code":""},{"path":"https://kylebutts.github.io/did2s/articles/Two-Stage-Difference-in-Differences.html","id":"anticipation","dir":"Articles","previous_headings":"Two-stage Difference-in-differences, Gardner (2021)","what":"Anticipation","title":"Two-Stage Difference-in-Differences","text":"Second, procedure works long \\(\\mu_i\\) \\(\\mu_t\\) consistently estimated. key use untreated/-yet-treated observations estimate fixed effects. example, used observations \\(D_{} = 1\\), attribute treatment effects \\(\\tau\\) “fixed characteristics” combine \\(\\mu_i\\) treatment effects. fixed effects biased/inconsistent anticipation effects, .e. units respond treatment starts. fix fairly simple, simply “shift” treatment date earlier many years suspect anticipation occur (e.g. 2 years treatment starts) estimate subsample shifted treatment equals zero.","code":""},{"path":"https://kylebutts.github.io/did2s/articles/Two-Stage-Difference-in-Differences.html","id":"covariates","dir":"Articles","previous_headings":"Two-stage Difference-in-differences, Gardner (2021)","what":"Covariates","title":"Two-Stage Difference-in-Differences","text":"method works pre-determined covariates well. Augment step 1. include \\(X_i\\) remove \\(y_{}\\) along fixed effects get \\(\\tilde{y}_{}\\).","code":""},{"path":"https://kylebutts.github.io/did2s/articles/Two-Stage-Difference-in-Differences.html","id":"did2s-r-package","dir":"Articles","previous_headings":"","what":"did2s R Package","title":"Two-Stage Difference-in-Differences","text":"did2s R package implements two-stage procedure described . install package, run following: Note: Windows users install Rtools running command, since need compile C++ code source. main function did2s(), estimates two-stage procedure. function really convenience wrapper (plus important transformations) around fixest::feols() return fixest object. important several reasons become clear examples follow. did2s() requires following arguments: yname: outcome variable. example, \"y\". first_stage: Formula indicating first stage. can include fixed effects covariates, include treatment variable(s)! efficiency, recommended use fixest convention specifying fixed effects vertical bar. example, ~ x1 + x2 | fe1 + fe2. second_stage: Formula indicating treatment variable , case event studies, treatment variables. , following fixest conventions, recommended use () syntax. example, ~ (time_to_treatment, ref = 0). treatment: binary (1/0) logical (TRUE/FALSE) variable demarcating treatment turns unit. example, \"treated\". Optional arguments include ability implement weighted regressions whether cluster bootstrap standard errors.","code":"remotes::install_github(\"kylebutts/did2s\")"},{"path":"https://kylebutts.github.io/did2s/articles/Two-Stage-Difference-in-Differences.html","id":"example","dir":"Articles","previous_headings":"did2s R Package","what":"Example","title":"Two-Stage Difference-in-Differences","text":"Let’s walk example dataset package. plot average outcome variable groups: Example data heterogeneous treatment effects","code":"library(did2s) ## The main package. Will automatically load fixest as well. #> Loading required package: fixest #> did2s (v1.0.2). For more information on the methodology, visit <https://www.kylebutts.github.io/did2s> #>  #> To cite did2s in publications use: #>  #>   Butts, Kyle (2021).  did2s: Two-Stage Difference-in-Differences #>   Following Gardner (2021). R package version 1.0.2. #>  #> A BibTeX entry for LaTeX users is #>  #>   @Manual{, #>     title = {did2s: Two-Stage Difference-in-Differences Following Gardner (2021)}, #>     author = {Kyle Butts}, #>     year = {2021}, #>     url = {https://github.com/kylebutts/did2s/}, #>   } library(ggplot2)   ## Load heterogeneous treatment dataset from the package data(\"df_het\") head(df_het) #>     unit state   group  unit_fe     g  year     year_fe  treat rel_year #>    <int> <int>  <char>    <num> <num> <int>       <num> <lgcl>    <num> #> 1:     1    33 Group 2 7.043016  2010  1990  0.06615889  FALSE      -20 #> 2:     1    33 Group 2 7.043016  2010  1991 -0.03098032  FALSE      -19 #> 3:     1    33 Group 2 7.043016  2010  1992 -0.11960742  FALSE      -18 #> 4:     1    33 Group 2 7.043016  2010  1993  0.12632146  FALSE      -17 #> 5:     1    33 Group 2 7.043016  2010  1994 -0.10692055  FALSE      -16 #> 6:     1    33 Group 2 7.043016  2010  1995 -0.27042020  FALSE      -15 #>    rel_year_binned       error    te te_dynamic  dep_var #>              <num>       <num> <num>      <num>    <num> #> 1:              -6 -0.08646599     0          0 7.022709 #> 2:              -6  0.76659269     0          0 7.778628 #> 3:              -6  1.51296819     0          0 8.436377 #> 4:              -6  0.02186978     0          0 7.191207 #> 5:              -6 -0.01760317     0          0 6.918492 #> 6:              -6  2.19452731     0          0 8.967123 # Mean for treatment group-year agg <- aggregate(df_het$dep_var, by=list(g = df_het$g, year = df_het$year), FUN = mean)  agg$g <- as.character(agg$g) agg$g <- ifelse(agg$g == \"0\", \"Never Treated\", agg$g)  never <- agg[agg$g == \"Never Treated\", ] g1 <- agg[agg$g == \"2000\", ] g2 <- agg[agg$g == \"2010\", ]   plot(0, 0, xlim = c(1990,2020), ylim = c(4,7.2), type = \"n\",      main = \"Data-generating Process\", ylab = \"Outcome\", xlab = \"Year\") abline(v = c(1999.5, 2009.5), lty = 2) lines(never$year, never$x, col = \"#8e549f\", type = \"b\", pch = 15) lines(g1$year, g1$x, col = \"#497eb3\", type = \"b\", pch = 17) lines(g2$year, g2$x, col = \"#d2382c\", type = \"b\", pch = 16) legend(x=1990, y=7.1, col = c(\"#8e549f\", \"#497eb3\", \"#d2382c\"),         pch = c(15, 17, 16),        legend = c(\"Never Treated\", \"2000\", \"2010\"))"},{"path":"https://kylebutts.github.io/did2s/articles/Two-Stage-Difference-in-Differences.html","id":"estimate-two-stage-difference-in-differences","dir":"Articles","previous_headings":"did2s R Package","what":"Estimate Two-stage Difference-in-Differences","title":"Two-Stage Difference-in-Differences","text":"First, lets estimate static . two things note . First, note can use fixest::feols formula including | specifying fixed effects fixest::improved factor variable support. Second, note did2s returns fixest estimate object, fixest::esttable, fixest::coefplot, fixest::iplot work expected. close true treatment effect ~2.23. , let’s estimate event study . Note relative year value Inf never treated, put reference second stage formula. plot results: Event-study plot example data","code":"# Static static <- did2s(df_het,                  yname = \"dep_var\", first_stage = ~ 0 | state + year,                  second_stage = ~i(treat, ref=FALSE), treatment = \"treat\",                  cluster_var = \"state\") #> Running Two-stage Difference-in-Differences #>  - first stage formula `~ 0 | state + year` #>  - second stage formula `~ i(treat, ref = FALSE)` #>  - The indicator variable that denotes when treatment is on is `treat` #>  - Standard errors will be clustered by `state`  fixest::esttable(static) #>                            static #> Dependent Var.:           dep_var #>                                   #> treat = TRUE    2.152*** (0.0476) #> _______________ _________________ #> S.E. type                  Custom #> Observations               46,500 #> R2                        0.33790 #> Adj. R2                   0.33790 #> --- #> Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 # Event Study es <- did2s(df_het,             yname = \"dep_var\", first_stage = ~ 0 | state + year,              second_stage = ~i(rel_year, ref=c(-1, Inf)), treatment = \"treat\",              cluster_var = \"state\") #> Running Two-stage Difference-in-Differences #>  - first stage formula `~ 0 | state + year` #>  - second stage formula `~ i(rel_year, ref = c(-1, Inf))` #>  - The indicator variable that denotes when treatment is on is `treat` #>  - Standard errors will be clustered by `state` fixest::iplot(es, main = \"Event study: Staggered treatment\", xlab = \"Relative time to treatment\", col = \"steelblue\", ref.line = -0.5)  # Add the (mean) true effects true_effects = head(tapply((df_het$te + df_het$te_dynamic), df_het$rel_year, mean), -1) points(-20:20, true_effects, pch = 20, col = \"black\")  # Legend legend(x=-20, y=3, col = c(\"steelblue\", \"black\"), pch = c(20, 20),         legend = c(\"Two-stage estimate\", \"True effect\"))"},{"path":"https://kylebutts.github.io/did2s/articles/Two-Stage-Difference-in-Differences.html","id":"comparison-to-twfe","dir":"Articles","previous_headings":"did2s R Package","what":"Comparison to TWFE","title":"Two-Stage Difference-in-Differences","text":"","code":"twfe = feols(dep_var ~ i(rel_year, ref=c(-1, Inf)) | unit + year, data = df_het)   fixest::iplot(list(es, twfe), sep = 0.2, ref.line = -0.5,       col = c(\"steelblue\", \"#82b446\"), pt.pch = c(20, 18),        xlab = \"Relative time to treatment\",        main = \"Event study: Staggered treatment (comparison)\")   # Legend legend(x=-20, y=3, col = c(\"steelblue\", \"#82b446\"), pch = c(20, 18),         legend = c(\"Two-stage estimate\", \"TWFE\"))"},{"path":"https://kylebutts.github.io/did2s/articles/Two-Stage-Difference-in-Differences.html","id":"citation","dir":"Articles","previous_headings":"","what":"Citation","title":"Two-Stage Difference-in-Differences","text":"use package produce scientific commercial publications, please cite according :","code":"citation(package = \"did2s\") #>  #> To cite did2s in publications use: #>  #>   Butts, Kyle (2021).  did2s: Two-Stage Difference-in-Differences #>   Following Gardner (2021). R package version 1.0.2. #>  #> A BibTeX entry for LaTeX users is #>  #>   @Manual{, #>     title = {did2s: Two-Stage Difference-in-Differences Following Gardner (2021)}, #>     author = {Kyle Butts}, #>     year = {2021}, #>     url = {https://github.com/kylebutts/did2s/}, #>   }"},{"path":"https://kylebutts.github.io/did2s/articles/Two-Stage-Difference-in-Differences.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Two-Stage Difference-in-Differences","text":"Borusyak, Kirill, Xavier Jaravel, Jann Spiess (2021). “Revisiting Event Study Designs: Robust Efficient Estimation”, Working Paper. Callaway, Brantly, Pedro H. C. Sant’Anna (2020). “Difference--differences multiple time periods.”, Journal Econometrics. de Chaisemartin, Clement, Xavier d’Haultfoeuille (2020). “Two-way fixed effects estimators heterogeneous treatment effects.”, American Economic Review. Gardner, John (2021). “Two-Stage Difference--Differences.”, Working Paper. Goodman-Bacon, Andrew (2021). “Difference--differences variation treatment timing.”, Journal Econometrics. Sun, Liyang, Sarah Abraham (2020). “Estimating dynamic treatment effects event studies heterogeneous treatment effects.”, Journal Econometrics.","code":""},{"path":"https://kylebutts.github.io/did2s/articles/event_study.html","id":"example-usage-of-event_study","dir":"Articles","previous_headings":"","what":"Example usage of event_study","title":"So you're trying to choose an event-study estimator...","text":"result event_study tibble tidy format contains point estimates standard errors relative time indicator individual estimator. results event_study dataframe event-study term, estimate, standard error, column containing character estimator used. output dataframe turn passed plot_event_study easy comparison. return df_het dataset see example usage functions. Event-study Estimators","code":"library(did2s) #> Loading required package: fixest #> did2s (v1.0.0). For more information on the methodology, visit <https://www.kylebutts.github.io/did2s> #>  #> To cite did2s in publications use: #>  #>   Butts, Kyle (2021).  did2s: Two-Stage Difference-in-Differences #>   Following Gardner (2021). R package version 1.0.0. #>  #> A BibTeX entry for LaTeX users is #>  #>   @Manual{, #>     title = {did2s: Two-Stage Difference-in-Differences Following Gardner (2021)}, #>     author = {Kyle Butts}, #>     year = {2021}, #>     url = {https://github.com/kylebutts/did2s/}, #>   } data(df_het, package = \"did2s\") out = event_study(   data = df_het, yname = \"dep_var\", idname = \"unit\",   tname = \"year\", gname = \"g\", estimator = \"all\" ) #> Note these estimators rely on different underlying assumptions. See Table 2 of `https://arxiv.org/abs/2109.05913` for an overview. #> Estimating TWFE Model #> Estimating using Gardner (2021) #> Estimating using Callaway and Sant'Anna (2020) #> Estimating using Sun and Abraham (2020) #> Estimating using Borusyak, Jaravel, Spiess (2021) #> Estimating using Roth and Sant'Anna (2021)  head(out) #>    estimator  term   estimate  std.error #>       <char> <num>      <num>      <num> #> 1:      TWFE   -20 0.04097725 0.07167704 #> 2:      TWFE   -19 0.13665695 0.07147683 #> 3:      TWFE   -18 0.14015820 0.07245520 #> 4:      TWFE   -17 0.15793252 0.07431871 #> 5:      TWFE   -16 0.09910002 0.07379570 #> 6:      TWFE   -15 0.20561127 0.07116478 plot_event_study(out, horizon = c(-5,10))"},{"path":"https://kylebutts.github.io/did2s/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Kyle Butts. Author, maintainer. John Gardner. Author. Grant McDermott. Contributor. Laurent Berge. Contributor.","code":""},{"path":"https://kylebutts.github.io/did2s/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Butts, Kyle (2021).  did2s: Two-Stage Difference--Differences Following Gardner (2021). R package version 1.0.2.","code":"@Manual{,   title = {did2s: Two-Stage Difference-in-Differences Following Gardner (2021)},   author = {Kyle Butts},   year = {2021},   url = {https://github.com/kylebutts/did2s/}, }"},{"path":"https://kylebutts.github.io/did2s/index.html","id":"did2s","dir":"","previous_headings":"","what":"Two-Stage Difference-in-Differences Following Gardner (2021)","title":"Two-Stage Difference-in-Differences Following Gardner (2021)","text":"goal did2s estimate TWFE models without running problem staggered treatment adoption. common issues, see issue: https://github.com/kylebutts/did2s/issues/12","code":""},{"path":"https://kylebutts.github.io/did2s/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Two-Stage Difference-in-Differences Following Gardner (2021)","text":"can install did2s CRAN : install development version, run following:","code":"install.packages(\"did2s\") devtools::install_github(\"kylebutts/did2s\")"},{"path":"https://kylebutts.github.io/did2s/index.html","id":"two-stage-difference-in-differences-gardner-2021","dir":"","previous_headings":"","what":"Two-stage Difference-in-differences (Gardner 2021)","title":"Two-Stage Difference-in-Differences Following Gardner (2021)","text":"details methodology, view vignette view documentation, type ?did2s console. main function did2s estimates two-stage procedure. function requires following options: yname: outcome variable first_stage: formula first stage, can include fixed effects covariates, include treatment variable(s)! second_stage: treatment variable case event studies, treatment variables. treatment: 0/1 treatment variable marks treatment turns unit. suspect anticipation, see note accounting . cluster_var: variables cluster Optional options: weights: Optional variable run weighted first- second-stage regressions bootstrap: standard errors bootstrapped instead? Default False. n_bootstraps: many clustered bootstraps perform standard errors. Default 250. did2s returns list two objects: fixest estimate second stage corrected standard errors.","code":""},{"path":"https://kylebutts.github.io/did2s/index.html","id":"twfe-vs-two-stage-did-example","dir":"","previous_headings":"Two-stage Difference-in-differences (Gardner 2021)","what":"TWFE vs. Two-Stage DID Example","title":"Two-Stage Difference-in-Differences Following Gardner (2021)","text":"load example data package plot average outcome among groups. plot average outcome variable groups: Example data heterogeneous treatment effects","code":"# Automatically loads fixest library(did2s) #> Loading required package: fixest #> did2s (v1.0.2). For more information on the methodology, visit <https://www.kylebutts.github.io/did2s> #>  #> To cite did2s in publications use: #>  #>   Butts, Kyle (2021).  did2s: Two-Stage Difference-in-Differences #>   Following Gardner (2021). R package version 1.0.2. #>  #> A BibTeX entry for LaTeX users is #>  #>   @Manual{, #>     title = {did2s: Two-Stage Difference-in-Differences Following Gardner (2021)}, #>     author = {Kyle Butts}, #>     year = {2021}, #>     url = {https://github.com/kylebutts/did2s/}, #>   }  # Load Data from R package data(\"df_het\", package = \"did2s\") # Mean for treatment group-year agg <- aggregate(df_het$dep_var, by=list(g = df_het$g, year = df_het$year), FUN = mean)  agg$g <- as.character(agg$g) agg$g <- ifelse(agg$g == \"0\", \"Never Treated\", agg$g)  never <- agg[agg$g == \"Never Treated\", ] g1 <- agg[agg$g == \"2000\", ] g2 <- agg[agg$g == \"2010\", ]   plot(0, 0, xlim = c(1990,2020), ylim = c(4,7.2), type = \"n\",      main = \"Data-generating Process\", ylab = \"Outcome\", xlab = \"Year\") abline(v = c(1999.5, 2009.5), lty = 2) lines(never$year, never$x, col = \"#8e549f\", type = \"b\", pch = 15) lines(g1$year, g1$x, col = \"#497eb3\", type = \"b\", pch = 17) lines(g2$year, g2$x, col = \"#d2382c\", type = \"b\", pch = 16) legend(x=1990, y=7.1, col = c(\"#8e549f\", \"#497eb3\", \"#d2382c\"),         pch = c(15, 17, 16),        legend = c(\"Never Treated\", \"2000\", \"2010\"))"},{"path":"https://kylebutts.github.io/did2s/index.html","id":"estimate-two-stage-difference-in-differences","dir":"","previous_headings":"Two-stage Difference-in-differences (Gardner 2021)","what":"Estimate Two-stage Difference-in-Differences","title":"Two-Stage Difference-in-Differences Following Gardner (2021)","text":"First, lets estimate static . two things note . First, note can use fixest::feols formula including | specifying fixed effects fixest::improved factor variable support. Second, note did2s returns fixest estimate object, fixest::etable, fixest::coefplot, fixest::iplot work expected. close true treatment effect ~2.23. , let’s estimate event study . Note relative year value Inf never treated, put reference second stage formula. plot results: Event-study plot example data","code":"# Static static <- did2s(df_het,                  yname = \"dep_var\", first_stage = ~ 0 | state + year,                  second_stage = ~i(treat, ref=FALSE), treatment = \"treat\",                  cluster_var = \"state\") #> Running Two-stage Difference-in-Differences #>  - first stage formula `~ 0 | state + year` #>  - second stage formula `~ i(treat, ref = FALSE)` #>  - The indicator variable that denotes when treatment is on is `treat` #>  - Standard errors will be clustered by `state`  fixest::etable(static) #>                            static #> Dependent Var.:           dep_var #>                                   #> treat = TRUE    2.152*** (0.0476) #> _______________ _________________ #> S.E. type                  Custom #> Observations               46,500 #> R2                        0.33790 #> Adj. R2                   0.33790 #> --- #> Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 # Event Study es <- did2s(df_het,             yname = \"dep_var\", first_stage = ~ 0 | state + year,              second_stage = ~i(rel_year, ref=c(-1, Inf)), treatment = \"treat\",              cluster_var = \"state\") #> Running Two-stage Difference-in-Differences #>  - first stage formula `~ 0 | state + year` #>  - second stage formula `~ i(rel_year, ref = c(-1, Inf))` #>  - The indicator variable that denotes when treatment is on is `treat` #>  - Standard errors will be clustered by `state` fixest::iplot(es, main = \"Event study: Staggered treatment\", xlab = \"Relative time to treatment\", col = \"steelblue\", ref.line = -0.5)  # Add the (mean) true effects true_effects = head(tapply((df_het$te + df_het$te_dynamic), df_het$rel_year, mean), -1) points(-20:20, true_effects, pch = 20, col = \"black\")  # Legend legend(x=-20, y=3, col = c(\"steelblue\", \"black\"), pch = c(20, 20),         legend = c(\"Two-stage estimate\", \"True effect\"))"},{"path":"https://kylebutts.github.io/did2s/index.html","id":"comparison-to-twfe","dir":"","previous_headings":"Two-stage Difference-in-differences (Gardner 2021)","what":"Comparison to TWFE","title":"Two-Stage Difference-in-Differences Following Gardner (2021)","text":"","code":"twfe = feols(dep_var ~ i(rel_year, ref=c(-1, Inf)) | unit + year, data = df_het)   fixest::iplot(list(es, twfe), sep = 0.2, ref.line = -0.5,       col = c(\"steelblue\", \"#82b446\"), pt.pch = c(20, 18),        xlab = \"Relative time to treatment\",        main = \"Event study: Staggered treatment (comparison)\")   # Legend legend(x=-20, y=3, col = c(\"steelblue\", \"#82b446\"), pch = c(20, 18),         legend = c(\"Two-stage estimate\", \"TWFE\"))"},{"path":"https://kylebutts.github.io/did2s/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Two-Stage Difference-in-Differences Following Gardner (2021)","text":"use package produce scientific commercial publications, please cite according :","code":"citation(package = \"did2s\") #>  #> To cite did2s in publications use: #>  #>   Butts, Kyle (2021).  did2s: Two-Stage Difference-in-Differences #>   Following Gardner (2021). R package version 1.0.2. #>  #> A BibTeX entry for LaTeX users is #>  #>   @Manual{, #>     title = {did2s: Two-Stage Difference-in-Differences Following Gardner (2021)}, #>     author = {Kyle Butts}, #>     year = {2021}, #>     url = {https://github.com/kylebutts/did2s/}, #>   }"},{"path":[]},{"path":"https://kylebutts.github.io/did2s/reference/castle.html","id":null,"dir":"Reference","previous_headings":"","what":"Data from Cheng and Hoekstra (2013) — castle","title":"Data from Cheng and Hoekstra (2013) — castle","text":"State-wide panel data 2000-2010 information castle-doctrine, -called \"stand--ground\" laws implemented 20 states.","code":""},{"path":"https://kylebutts.github.io/did2s/reference/castle.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Data from Cheng and Hoekstra (2013) — castle","text":"","code":"castle"},{"path":"https://kylebutts.github.io/did2s/reference/castle.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Data from Cheng and Hoekstra (2013) — castle","text":"data frame 550 rows 5 variables: sid state id, unit observation year time panel data l_homicide log number homicides per capita effyear year castle doctrine passed post 0/1 variable castle doctrine active time_til time relative castle doctrine passed law","code":""},{"path":"https://kylebutts.github.io/did2s/reference/df_het.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulated data with two treatment groups and heterogenous effects — df_het","title":"Simulated data with two treatment groups and heterogenous effects — df_het","text":"Generated using following call: did2s::gen_data(panel = c(1990, 2020),   g1 = 2000, g2 = 2010, g3 = 0,   te1 = 2, te2 = 1, te3 = 0,   te_m1 = 0.05, te_m2 = 0.15, te_m3 = 0)","code":""},{"path":"https://kylebutts.github.io/did2s/reference/df_het.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulated data with two treatment groups and heterogenous effects — df_het","text":"","code":"df_het"},{"path":"https://kylebutts.github.io/did2s/reference/df_het.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Simulated data with two treatment groups and heterogenous effects — df_het","text":"data frame 31000 rows 15 variables: unit individual panel data year time panel data g year treatment starts dep_var outcome variable treat T/F variable treatment rel_year year relative treatment start. Inf = never treated. rel_year_binned year relative treatment start, <=-6 >=6 binned. unit_fe Unit FE year_fe Year FE error Random error component te Static treatment effect = te te_dynamic Dynamic treatmet effect = te_m state State unit group String name group","code":""},{"path":"https://kylebutts.github.io/did2s/reference/df_hom.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulated data with two treatment groups and homogenous effects — df_hom","title":"Simulated data with two treatment groups and homogenous effects — df_hom","text":"Generated using following call: did2s::gen_data(panel = c(1990, 2020),   g1 = 2000, g2 = 2010, g3 = 0,   te1 = 2, te2 = 2, te3 = 0,   te_m1 = 0, te_m2 = 0, te_m3 = 0)","code":""},{"path":"https://kylebutts.github.io/did2s/reference/df_hom.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulated data with two treatment groups and homogenous effects — df_hom","text":"","code":"df_hom"},{"path":"https://kylebutts.github.io/did2s/reference/df_hom.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Simulated data with two treatment groups and homogenous effects — df_hom","text":"data frame 31000 rows 15 variables: unit individual panel data year time panel data g year treatment starts dep_var outcome variable treat T/F variable treatment rel_year year relative treatment start. Inf = never treated. rel_year_binned year relative treatment start, <=-6 >=6 binned. unit_fe Unit FE year_fe Year FE error Random error component te Static treatment effect = te te_dynamic Dynamic treatmet effect = te_m group String name group state State unit weight Weight runif()","code":""},{"path":"https://kylebutts.github.io/did2s/reference/did2s.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate two-stage difference-in-differences following Gardner (2021) — did2s","title":"Calculate two-stage difference-in-differences following Gardner (2021) — did2s","text":"Calculate two-stage difference--differences following Gardner (2021)","code":""},{"path":"https://kylebutts.github.io/did2s/reference/did2s.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate two-stage difference-in-differences following Gardner (2021) — did2s","text":"","code":"did2s(   data,   yname,   first_stage,   second_stage,   treatment,   cluster_var,   weights = NULL,   bootstrap = FALSE,   n_bootstraps = 250,   return_bootstrap = FALSE,   verbose = TRUE )"},{"path":"https://kylebutts.github.io/did2s/reference/did2s.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate two-stage difference-in-differences following Gardner (2021) — did2s","text":"data dataframe containing variables yname Outcome variable first_stage Fixed effects covariates want residualize first stage. Formula following fixest::feols. Fixed effects specified \"|\". second_stage Second stage, treatment indicator(s) (e.g. treatment variable event-study leads/lags). Formula following fixest::feols. Use () factor variables, see fixest::. treatment variable = 1 treated, = 0 otherwise cluster_var variable cluster standard errors. can IDs higher aggregate level (state example) weights Optional. Variable name regression weights. bootstrap Optional. standard errors calculated using bootstrap? Default FALSE. n_bootstraps Optional. many bootstraps run. Default 250. return_bootstrap Optional. Logical. return bootstrap second-stage estimate allow manual use, e.g. percentile standard errors empirical confidence intervals. verbose Optional. Logical. information two-stage procedure printed back user? Default TRUE.","code":""},{"path":"https://kylebutts.github.io/did2s/reference/did2s.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate two-stage difference-in-differences following Gardner (2021) — did2s","text":"fixest object adjusted standard errors (either formula bootstrap). methods fixest package work, including fixest::esttable fixest::coefplot","code":""},{"path":"https://kylebutts.github.io/did2s/reference/did2s.html","id":"examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate two-stage difference-in-differences following Gardner (2021) — did2s","text":"Load example dataset two treatment groups homogeneous treatment effects","code":"# Load Example Dataset data(\"df_hom\")"},{"path":"https://kylebutts.github.io/did2s/reference/did2s.html","id":"static-twfe","dir":"Reference","previous_headings":"","what":"Static TWFE","title":"Calculate two-stage difference-in-differences following Gardner (2021) — did2s","text":"can run static TWFE fixed effect model simple treatment indicator","code":"static <- did2s(df_hom,     yname = \"dep_var\", treatment = \"treat\", cluster_var = \"state\",     first_stage = ~ 0 | unit + year,     second_stage = ~ i(treat, ref=FALSE)) #> Running Two-stage Difference-in-Differences #>  - first stage formula `~ 0 | unit + year` #>  - second stage formula `~ i(treat, ref = FALSE)` #>  - The indicator variable that denotes when treatment is on is `treat` #>  - Standard errors will be clustered by `state`  fixest::esttable(static) #>                            static #> Dependent Var.:           dep_var #>                                   #> treat = TRUE    2.005*** (0.0202) #> _______________ _________________ #> S.E. type                  Custom #> Observations               46,500 #> R2                        0.47520 #> Adj. R2                   0.47520 #> --- #> Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1"},{"path":"https://kylebutts.github.io/did2s/reference/did2s.html","id":"event-study","dir":"Reference","previous_headings":"","what":"Event Study","title":"Calculate two-stage difference-in-differences following Gardner (2021) — did2s","text":"can use relative-treatment indicators estimate event study estimate","code":"es <- did2s(df_hom,     yname = \"dep_var\", treatment = \"treat\", cluster_var = \"state\",     first_stage = ~ 0 | unit + year,     second_stage = ~ i(rel_year, ref=c(-1, Inf))) #> Running Two-stage Difference-in-Differences #>  - first stage formula `~ 0 | unit + year` #>  - second stage formula `~ i(rel_year, ref = c(-1, Inf))` #>  - The indicator variable that denotes when treatment is on is `treat` #>  - Standard errors will be clustered by `state`  fixest::esttable(es) #>                                es #> Dependent Var.:           dep_var #>                                   #> rel_year = -20    0.0043 (0.0322) #> rel_year = -19    0.0222 (0.0296) #> rel_year = -18   -0.0358 (0.0308) #> rel_year = -17    0.0043 (0.0337) #> rel_year = -16   -0.0186 (0.0353) #> rel_year = -15   -0.0045 (0.0346) #> rel_year = -14   -0.0393 (0.0384) #> rel_year = -13    0.0453 (0.0323) #> rel_year = -12    0.0324 (0.0309) #> rel_year = -11   -0.0245 (0.0349) #> rel_year = -10   -0.0017 (0.0241) #> rel_year = -9     0.0155 (0.0242) #> rel_year = -8    -0.0073 (0.0210) #> rel_year = -7   -0.0513* (0.0202) #> rel_year = -6     0.0269 (0.0237) #> rel_year = -5     0.0136 (0.0237) #> rel_year = -4    0.0381. (0.0223) #> rel_year = -3    -0.0228 (0.0284) #> rel_year = -2     0.0041 (0.0228) #> rel_year = 0    1.971*** (0.0470) #> rel_year = 1    2.050*** (0.0466) #> rel_year = 2    2.033*** (0.0441) #> rel_year = 3    1.966*** (0.0400) #> rel_year = 4    1.965*** (0.0430) #> rel_year = 5    2.030*** (0.0456) #> rel_year = 6    2.040*** (0.0447) #> rel_year = 7    1.995*** (0.0370) #> rel_year = 8    2.019*** (0.0485) #> rel_year = 9    1.955*** (0.0468) #> rel_year = 10   1.950*** (0.0455) #> rel_year = 11   2.117*** (0.0664) #> rel_year = 12   2.132*** (0.0741) #> rel_year = 13   2.019*** (0.0640) #> rel_year = 14   2.013*** (0.0522) #> rel_year = 15   1.961*** (0.0605) #> rel_year = 16   1.916*** (0.0584) #> rel_year = 17   1.938*** (0.0607) #> rel_year = 18   2.070*** (0.0666) #> rel_year = 19   2.066*** (0.0609) #> rel_year = 20   1.964*** (0.0612) #> _______________ _________________ #> S.E. type                  Custom #> Observations               46,500 #> R2                        0.47577 #> Adj. R2                   0.47533 #> --- #> Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 # plot rel_year coefficients and standard errors fixest::coefplot(es, keep = \"rel_year::(.*)\")"},{"path":"https://kylebutts.github.io/did2s/reference/did2s.html","id":"example-from-cheng-and-hoekstra-","dir":"Reference","previous_headings":"","what":"Example from Cheng and Hoekstra (2013)","title":"Calculate two-stage difference-in-differences following Gardner (2021) — did2s","text":"example using data Cheng Hoekstra (2013)","code":"# Castle Data castle <- haven::read_dta(\"https://github.com/scunning1975/mixtape/raw/master/castle.dta\")  did2s(   data = castle,   yname = \"l_homicide\",   first_stage = ~ 0 | sid + year,   second_stage = ~ i(post, ref=0),   treatment = \"post\",   cluster_var = \"state\", weights = \"popwt\" ) #> Running Two-stage Difference-in-Differences #>  - first stage formula `~ 0 | sid + year` #>  - second stage formula `~ i(post, ref = 0)` #>  - The indicator variable that denotes when treatment is on is `post` #>  - Standard errors will be clustered by `state` #> OLS estimation, Dep. Var.: l_homicide #> Observations: 550  #> Weights: weights_vector  #> Standard-errors: Custom  #>         Estimate Std. Error t value Pr(>|t|)     #> post::1 0.075142    0.03538 2.12387 0.034127 *   #> --- #> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 #> RMSE: 263.4   Adj. R2: 0.052465"},{"path":"https://kylebutts.github.io/did2s/reference/event_study.html","id":null,"dir":"Reference","previous_headings":"","what":"Estimate event-study coefficients using TWFE and 5 proposed improvements. — event_study","title":"Estimate event-study coefficients using TWFE and 5 proposed improvements. — event_study","text":"Uses estimation procedures recommended Borusyak, Jaravel, Spiess (2021); Callaway Sant'Anna (2020); Gardner (2021); Roth Sant'Anna (2021); Sun Abraham (2020)","code":""},{"path":"https://kylebutts.github.io/did2s/reference/event_study.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Estimate event-study coefficients using TWFE and 5 proposed improvements. — event_study","text":"","code":"event_study(   data,   yname,   idname,   gname,   tname,   xformla = NULL,   weights = NULL,   estimator = c(\"all\", \"TWFE\", \"did2s\", \"did\", \"impute\", \"sunab\", \"staggered\") )  plot_event_study(out, separate = TRUE, horizon = NULL)"},{"path":"https://kylebutts.github.io/did2s/reference/event_study.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Estimate event-study coefficients using TWFE and 5 proposed improvements. — event_study","text":"data dataframe containing variables yname Variable name outcome variable idname Variable name unique unit id gname Variable name unit-specific date initial treatment (never-treated zero NA) tname Variable name calendar period xformla formula covariates include model. form ~ X1 + X2. Default NULL. weights Variable name estimation weights. used estimating Y(0) also augments treatment effect weights estimator Estimator like use. Use \"\" estimate . Otherwise see table know advantages requirements . Output event_study() separate Logical. estimators separate plots? Default TRUE. horizon Numeric. Vector length 2. First element min second element max event_time plot","code":""},{"path":"https://kylebutts.github.io/did2s/reference/event_study.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Estimate event-study coefficients using TWFE and 5 proposed improvements. — event_study","text":"event_study returns data.frame point estimates estimator plot_event_study returns ggplot object can fully customized","code":""},{"path":"https://kylebutts.github.io/did2s/reference/event_study.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Estimate event-study coefficients using TWFE and 5 proposed improvements. — event_study","text":"","code":"# \\donttest{ out = event_study(   data = did2s::df_het, yname = \"dep_var\", idname = \"unit\",   tname = \"year\", gname = \"g\", estimator = \"all\" ) #> Note these estimators rely on different underlying assumptions. See Table 2 of `https://arxiv.org/abs/2109.05913` for an overview. #> Estimating TWFE Model #> Estimating using Gardner (2021) #> Estimating using Callaway and Sant'Anna (2020) #> Estimating using Sun and Abraham (2020) #> Estimating using Borusyak, Jaravel, Spiess (2021) #> Estimating using Roth and Sant'Anna (2021) plot_event_study(out)  # }"},{"path":"https://kylebutts.github.io/did2s/reference/gen_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Generate TWFE data — gen_data","title":"Generate TWFE data — gen_data","text":"Generate TWFE data","code":""},{"path":"https://kylebutts.github.io/did2s/reference/gen_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generate TWFE data — gen_data","text":"","code":"gen_data(   g1 = 2000,   g2 = 2010,   g3 = 0,   panel = c(1990, 2020),   te1 = 2,   te2 = 2,   te3 = 2,   te_m1 = 0,   te_m2 = 0,   te_m3 = 0,   n = 1500 )"},{"path":"https://kylebutts.github.io/did2s/reference/gen_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generate TWFE data — gen_data","text":"g1 treatment date group 1. treatment, set g = 0. g2 treatment date group 2. treatment, set g = 0. g3 treatment date group 3. treatment, set g = 0. panel numeric vector size 2, start end years panel te1 treatment effect group 1. ignore group g = 0. te2 treatment effect group 1. ignore group g = 0. te3 treatment effect group 1. ignore group g = 0. te_m1 treatment effect slope per year te_m2 treatment effect slope per year te_m3 treatment effect slope per year n number individuals sample","code":""},{"path":"https://kylebutts.github.io/did2s/reference/gen_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Generate TWFE data — gen_data","text":"Dataframe generated data","code":""},{"path":"https://kylebutts.github.io/did2s/reference/gen_data.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Generate TWFE data — gen_data","text":"","code":"# Homogeneous treatment effect df_hom <- gen_data(panel = c(1990, 2020),     g1 = 2000, g2 = 2010, g3 = 0,     te1 = 2, te2 = 2, te3 = 0,     te_m1 = 0, te_m2 = 0, te_m3 = 0) # Heterogeneous treatment effect df_het <- gen_data(panel = c(1990, 2020),     g1 = 2000, g2 = 2010, g3 = 0,     te1 = 2, te2 = 1, te3 = 0,     te_m1 = 0.05, te_m2 = 0.15, te_m3 = 0)"},{"path":"https://kylebutts.github.io/did2s/news/index.html","id":"did2s-101","dir":"Changelog","previous_headings":"","what":"did2s 1.0.1","title":"did2s 1.0.1","text":"CRAN release: 2023-03-27 One line change sped-big datasets something like 15x facepalm","code":""},{"path":"https://kylebutts.github.io/did2s/news/index.html","id":"did2s-070","dir":"Changelog","previous_headings":"","what":"did2s 0.7.0","title":"did2s 0.7.0","text":"CRAN release: 2022-07-21 Add ARMA_64_BIT larger matricies","code":""},{"path":"https://kylebutts.github.io/did2s/news/index.html","id":"did2s-060","dir":"Changelog","previous_headings":"","what":"did2s 0.6.0","title":"did2s 0.6.0","text":"CRAN release: 2022-04-07 Added estimator argument event_study added vignette discussing different estimators’ assumptions Fixed “seperate” argument typo plot_event_study, may break previous code (https://github.com/kylebutts/did2s/pull/15/)","code":""},{"path":"https://kylebutts.github.io/did2s/news/index.html","id":"did2s-050","dir":"Changelog","previous_headings":"","what":"did2s 0.5.0","title":"did2s 0.5.0","text":"Made code robust improving sparse model matrix creation Rewrote covariance matrix creation faster robust Improved block bootstrapping code using boot::boot Fixed Sun Abraham bug event_study, h/t Frederik Noack","code":""},{"path":"https://kylebutts.github.io/did2s/news/index.html","id":"did2s-040","dir":"Changelog","previous_headings":"","what":"did2s 0.4.0","title":"did2s 0.4.0","text":"CRAN release: 2021-09-27 Add event_study plot_event_study functions Seperated did_imputation new package didimputation","code":""},{"path":"https://kylebutts.github.io/did2s/news/index.html","id":"did2s-030","dir":"Changelog","previous_headings":"","what":"did2s 0.3.0","title":"did2s 0.3.0","text":"Add did_imputation following Borusyak, Jaravel, Spiess (2021) Speed did2s","code":""},{"path":"https://kylebutts.github.io/did2s/news/index.html","id":"did2s-020","dir":"Changelog","previous_headings":"","what":"did2s 0.2.0","title":"did2s 0.2.0","text":"Use sparse matrices use much less memory Fix analytic standard errors using weights","code":""},{"path":"https://kylebutts.github.io/did2s/news/index.html","id":"did2s-010","dir":"Changelog","previous_headings":"","what":"did2s 0.1.0","title":"did2s 0.1.0","text":"Correct robust standard errors","code":""}]
